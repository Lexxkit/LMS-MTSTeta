<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="fragments/head :: head"></head>

<body>
  <header th:replace="fragments/header :: header"></header>
  <main class="container mt-3">
    <section>
      <h1 class="h1 text-center mx-auto mt-4 py-5"><strong>Курсы</strong></h1>
      <div class="row">
        <div class="col-12 col-md-8 col-lg-6 offset-lg-3 offset-md-2">
          <form class="form-inline mb-3" enctype="multipart/form-data">
            <label for="titlePrefix">Search courses by title</label>
            <div class="form-group col-8 col-md-10 pl-0">
              <input class="form-control w-100" type="search" id="titlePrefix" name="titlePrefix" th:value="${param.titlePrefix}"
                     placeholder="Course title" aria-label="Find course">
            </div>
            <div class="form-group col-4 col-md-2 pl-0">
              <button class="btn btn-success w-100" type="submit">Find!</button>
            </div>
          </form>
        </div>
      </div>
    </section>

    <section>
      <div>
        <a sec:authorize="hasRole('ADMIN')" th:href="@{/course/new}">Добавить новый курс</a>
      </div>
      <div class="text-center">
        <a sec:authorize="!isAuthenticated()" th:href="@{/user/registration}">Регистрация нового пользователя</a>
      </div>
    </section>

    <section class="mt-2 pt-1" sec:authorize="isAuthenticated()">
      <table class="table table-striped table-success">
        <thead>
          <tr>
            <th scope="col">id</th>
            <th scope="col">Название</th>
            <th scope="col">Автор</th>
            <th scope="col">Назначить/удалить</th>
          </tr>
        </thead>
        <tbody>
          <tr th:unless="${courses.empty}" th:each="course : ${courses}">
            <th scope="row" th:text="${course.id}">1</th>
            <td>
              <a th:text="${course.title}" th:href="@{/course/{id}(id = ${course.id})}">Название курса</a>
            </td>
            <td th:text="${course.author}">Автор курса</td>
            <td class="row">
              <div class="col-6 previous">
                <form sec:authorize="isAuthenticated()" th:method="get" th:action="@{/course/{id}/assign(id = ${course.id})}">
                  <button class="btn btn-success" type="submit">Назначить пользователя</button>
                </form>
              </div>
              <div class="col-6 next">
                <form sec:authorize="hasRole('ADMIN')" th:method="delete" th:action="@{/course/{id}(id = ${course.id})}">
                  <button class="btn btn-danger" type="submit">Удалить курс</button>
                </form>
              </div>
            </td>
          </tr>
          <tr th:if="${courses.empty}" >
            <td colspan="4">No courses to display</td>
          </tr>
        </tbody>
      </table>
    </section>

    <section class="mt-5 pt-3" >
      <h2 class="h2 font-weight-normal text-center mb-5">Действующие курсы</h2>
      <div class="row mb-0">
        <div class="col-6 col-md-6 col-lg-4" th:unless="${courses.empty}" th:each="course : ${courses}">
          <div class="card pt-4 text-center mb-4">

            <img class="mx-auto d-block" th:src="@{/course/{id}/picture(id = ${course.id})}" width="80" height="80" alt="">

            <div class="card-body">
              <p class="card-text mb-2">
                <a th:text="${course.title}" th:href="@{/course/{id}(id = ${course.id})}">Название курса</a>
              </p>
              <p class="card-text" th:text="${course.author}">Начни свое изучение фронтеда</p>
            </div>
          </div>
        </div>
        <div th:if="${courses.empty}">
          <p>No courses to display</p>
        </div>
      </div>
      <div th:if="${totalPages > 1}">
        <div class="row col-sm-10">
          <div class="col-sm-2">
            Всего курсов: [[${totalItems}]]
          </div>
          <div class="col-sm-1">
            <span th:each="i: ${#numbers.sequence(1, totalPages)}">
						  <a th:if="${currentPage != i}" th:href="@{'/course/page/' + ${i}}">[[${i}]]</a>
						  <span th:unless="${currentPage != i}">[[${i}]]</span>  &nbsp; &nbsp;
					</span>
          </div>
          <div class="col-sm-1">
            <a th:if="${currentPage < totalPages}" th:href="@{'/course/page/' + ${currentPage + 1}}">Next</a>
            <span th:unless="${currentPage < totalPages}">Next</span>
          </div>
          <div class="col-sm-1">
            <a th:if="${currentPage < totalPages}" th:href="@{'/course/page/' + ${totalPages}}">Last</a>
            <span th:unless="${currentPage < totalPages}">Last</span>
          </div>
        </div>
      </div>
    </section>
  </main>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</body>
</html>
