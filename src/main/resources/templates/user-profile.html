<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="fragments/head :: head"></head>

<header th:replace="fragments/header :: header"></header>

<body>
<main class="container">
  <div class="row">
    <div class="col-12 col-lg-8 offset-2 offset-lg-12">

      <div class="text-center mt-3 b-1">
        <h1 class="h3 mb-3 font-weight-normal">Привет, <span sec:authentication="principal.username"></span>!</h1>
      </div>

      <div class="text-center mt-2">
        <img th:unless="${avatar.empty}" th:src="@{/profile/avatar}" alt="User profile" width="120">
        <img th:if="${avatar.empty}" src="https://place-hold.it/120x120" width="120" height="120">

        <form th:method="post" th:action="@{/profile/avatar}" enctype="multipart/form-data">
          <div>
            <div class="text-center mt-2"><label for="avatar">Выберите картинку для загрузки</label></div>
            <input id="avatar" name="avatar" type="file"/>
          </div>
          <div>
            <div class="form-group">
              <input type="submit" class="btn btn-success" value="Обновить аватар">
            </div>
          </div>
        </form>
      </div>

      <div class="row">
        <div class="col">
          <form class="form-signin pt-2" th:object="${user}" th:method="post" th:action="@{/profile}">
            <input type="hidden" th:field="*{id}">

            <div class="text-center mt-2 b-1">

              <h1 class="h3 mb-3 font-weight-normal">Personal Info</h1>

            </div>
            <div class="mt-1 form-label-group">
              <p class="text">First Name</p>
              <input type="text" id="firstName" class="form-control" th:field="*{firstName}">
              <label for="firstName"></label>
              <small class="validation-error text-danger" th:if="${#fields.hasErrors('firstName')}"
                     th:errors="*{firstName}">
                Check spelling.
              </small>
            </div>

            <div class="mt-1 form-label-group">
              <p class="text">Last Name</p>
              <input type="text" id="lastName" class="form-control" th:field="*{lastName}">
              <label for="lastName"></label>
              <small class="validation-error text-danger" th:if="${#fields.hasErrors('lastName')}"
                     th:errors="*{lastName}">
                Check spelling.
              </small>
            </div>

            <div class="mt-3 form-label-group">
              <p class="text">Username</p>
              <input type="text" id="username" class="form-control" th:field="*{username}">
              <label for="username"></label>
              <small class="validation-error text-danger" th:if="${#fields.hasErrors('username')}"
                     th:errors="*{username}">
                Username has to be filled
              </small>
            </div>

            <div class="form-label-group">
              <p class="text">Password</p>
              <input type="password" id="password" class="form-control" th:field="*{password}">
              <label for="password"></label>
              <small class="validation-error text-danger" th:if="${#fields.hasErrors('password')}"
                     th:errors="*{password}">
                Password has to be filled
              </small>
            </div>

            <div class="mt-3 form-label-group">
              <p class="text">Email</p>
              <input type="text" id="email" class="form-control" th:field="*{email}">
              <label for="email"></label>
              <small class="validation-error text-danger" th:if="${#fields.hasErrors('email')}"
                     th:errors="*{email}">
                Email has to be filled
              </small>
            </div>

            <div class="form-label-group">
              <p class="text">Phone</p>
              <input type="text" id="phone" class="form-control" th:field="*{phone}">
              <label for="phone"></label>
              <small class="validation-error text-danger" th:if="${#fields.hasErrors('phone')}"
                     th:errors="*{phone}">
                Phone has to be filled
              </small>
            </div>

            <div class="form-label-group">
              <p class="text">Social Network Link</p>
              <input type="text" id="socialNetworkLink" class="form-control" th:field="*{socialNetworkLink}">
              <label for="socialNetworkLink"></label>
            </div>

            <div class="form-label-group">
              <p class="text">Achievements</p>
              <input type="text" id="achievements" class="form-control" th:field="*{achievements}">
              <label for="achievements"></label>
            </div>

            <div sec:authorize="hasAnyRole('ADMIN', 'OWNER')" class="mt-5 form-label-group">
              <label class="mb-2" for="roles">Choose user's role:</label>
              <select multiple class="form-control custom-select mr-sm-2" id="roles" th:field="*{roles}" required>
                <option th:each="role : ${roles}"
                        th:text="${role.name}"
                        th:value="${role.id}"
                        th:selected="${user.roles?.contains(role)}">
                </option>
              </select>
            </div>

            <div class="form-group">
              <input type="submit" class="btn btn-success" value="Обновить данные">
            </div>
          </form>
        </div>

        <div class="col">
          <section class="mt-3">
            <h2 class="h2 font-weight-normal text-center mb-5">Ваши курсы:</h2>
            <div class="mt-1 form-label-group text-center" th:unless="${courses.empty}" th:each="course : ${courses}">
              <p> <a th:text="${course.title}" th:href="@{/course/{id}(id = ${course.id})}">Название курса</a></p>
            </div>
            <div class="text-center" th:if="${courses.empty}">
              <p>У вас нет действующих курсов.</p>
            </div>
            <div class="text-center mt-2">
              <a th:href="@{/course}">Хотите записаться на новый курс?</a>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>
</main>
</body>
</html>
